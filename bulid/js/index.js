var songList,controlManager,audio,$=window.Zepto,root=window.player,$scope=$(document.body),barLen=$scope.find(".pro-wrapper").width(),progBar=$scope.find(".pro-bottom"),topBar=$scope.find(".pro-top"),curTime=$scope.find(".cur-time"),allTime=$scope.find(".all-time"),index=0;barLen=$scope.find(".pro-wrapper").width();function getData(o){$.ajax({type:"GET",url:o,success:function(o){console.log(o),songList=o,root.render(o[index]),bindEvent(),controlManager=new root.ControlManager(o.length),audio=new root.AudioControl,$scope.trigger("play:change",index)},error:function(){console.log("error")}})}function bindEvent(){$scope.on("play:change",function(){audio.getAudio(songList[index].audio),"play"==audio.status&&audio.play(),audio.ontimeupdate=function(){root.getCurTime(audio)}});var n=setInterval(function(){root.getCurTime(audio.audio)},500);$scope.find(".prev-btn").on("click",function(){index=controlManager.prev(),root.render(songList[index]),$scope.trigger("play:change",index)}),$scope.find(".next-btn").on("click",function(){index=controlManager.next(),root.render(songList[index]),$scope.trigger("play:change",index)}),$scope.find(".play-btn").on("click",function(){"play"==audio.status?audio.pause():audio.play(),$(this).toggleClass("pause")}),$scope.find(".like-btn").on("click",function(){$(this).toggleClass("liking")}),progBar.on("mousedown",function(o){clearInterval(n),root.dragBar(songList[index],o)}).on("mouseup",function(){n=setInterval(function(){progBar.off("mousedown"),root.getCurTime(audio.audio)},500)}),topBar.on("mousedown",function(o){root.dragBar(songList[index],o)}).on("mouseup",function(){n=setInterval(function(){topBar.off("mousedown"),root.getCurTime(audio.audio)},500)})}getData("../mock/data.json");